# Typedown: å…±è¯†å»ºæ¨¡è¯­è¨€ (CML)

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python 3.12+](https://img.shields.io/badge/python-3.12+-blue.svg)](https://www.python.org/downloads/)

**Typedown** æ˜¯ä¸€é—¨ä¸º **æ–‡å­¦å»ºæ¨¡ (Literate Modeling)** è€Œç”Ÿçš„è¯­è¨€ã€‚å®ƒæ—¨åœ¨å¼¥åˆæ€æƒ³çš„æµåŠ¨æ€§ï¼ˆMarkdownï¼‰ä¸å·¥ç¨‹çš„ä¸¥è°¨æ€§ï¼ˆPydantic + Pytestï¼‰ä¹‹é—´çš„é¸¿æ²Ÿã€‚

> **"Until you model it, you don't know it."** (ç›´åˆ°ä½ å»ºç«‹äº†æ¨¡å‹ï¼Œä½ æ‰çœŸæ­£äº†è§£å®ƒã€‚) â€” [å®£è¨€](docs/zh/manifesto.md)

---

## ä¸­æ–‡æ–‡æ¡£èµ„æº

- **[æ ¸å¿ƒç†å¿µ](docs/zh/00-æ ¸å¿ƒç†å¿µ.md)**: ä¸ºä»€ä¹ˆé€‰æ‹©â€œå¼•ç”¨å³æŸ¥è¯¢â€å’Œâ€œç¯å¢ƒå³åœºåŸŸâ€ã€‚
- **[è¯­æ³•æŒ‡å—](docs/zh/01-è¯­æ³•/01-ä»£ç å—.md)**: `model`, `entity`, `spec`, `config` çš„è¯¦ç»†ç”¨æ³•ã€‚
- **[è¿è¡Œæ‰‹å†Œ](docs/zh/03-è¿è¡Œ/02-è´¨é‡æ§åˆ¶.md)**: äº†è§£ L1-L4 çš„è´¨é‡æ§åˆ¶æµæ°´çº¿ã€‚

---

## ä¸‰ä½ä¸€ä½“ (The Trinity)

Typedown å°† Markdown è§†ä¸º **å…±è¯†å³ä»£ç  (Consensus as Code - CaC)** çš„ä¸€ç­‰å…¬æ°‘è¯­è¨€ï¼Œæ„å»ºåœ¨ä¸‰å¤§æ”¯æŸ±ä¹‹ä¸Šï¼š

1. **Markdown (ç•Œé¢å±‚)**: ä¿ç•™è‡ªç„¶è¯­è¨€çš„è¡¨è¾¾åŠ›ã€‚å®ƒæ˜¯äººç±»æ€è€ƒä¸ AI åä½œçš„åŸç”ŸåœºåŸŸã€‚
2. **Pydantic (ç»“æ„å±‚)**: é€šè¿‡ `model` å—å®šä¹‰ä¸¥è°¨çš„æ•°æ®æ¶æ„ã€‚
3. **Pytest (é€»è¾‘å±‚)**: é€šè¿‡ `spec` å—å¼ºåˆ¶æ‰§è¡Œä¸šåŠ¡è§„åˆ™ä¸é€»è¾‘æ–­è¨€ã€‚

## æ ¸å¿ƒç†å¿µï¼šæ´»æ€§è½¯ç‰©è´¨ (Active Soft Matter)

åœ¨ Typedown çš„ä¸–ç•Œè§‚é‡Œï¼Œæ•°æ®æ˜¯æœ‰â€œç‰©æ€â€çš„ï¼š

| æ•°æ®å½¢å¼     | ç‰©ç†å¯¹åº”       | ç‰¹æ€§                                   | ç¼ºé™·                             |
| :----------- | :------------- | :------------------------------------- | :------------------------------- |
| **è‡ªç”±æ–‡æœ¬** | **ç®€å•æ¶²ä½“**   | æé«˜æµåŠ¨æ€§ï¼Œéšå®¹å™¨è€Œå˜ã€‚               | **é«˜ç†µ**ã€‚æ— æ³•æ‰¿è½½å¤æ‚é€»è¾‘ã€‚     |
| **JSON/SQL** | **é‡‘å±æ™¶ä½“**   | ä¸¥æ ¼æœ‰åºï¼Œåšç¡¬ä¸”è„†ã€‚                   | **æ­»ç‰©è´¨**ã€‚Schema å˜æ›´å³å´©å¡Œã€‚  |
| **Typedown** | **æ´»æ€§è½¯ç‰©è´¨** | **å…·å¤‡ç›¸å˜èƒ½åŠ›**ã€‚å¯åœ¨åŸä½ç»“æ™¶æˆ–é…¶è§£ã€‚ | éœ€è¦å·¥å…·é“¾ï¼ˆLSP/Compilerï¼‰æ”¯æŒã€‚ |

Typedown å…è®¸ä¿¡æ¯åœ¨åŒä¸€ä¸ªæ–‡æ¡£å†…å‘ç”Ÿ**ç›¸å˜**ï¼šä»æ¨¡ç³Šçš„ç¬”è®°ï¼ˆæ¶²ä½“ï¼‰é€æ­¥â€œåŸä½ç»“æ™¶â€ä¸ºå—é™åˆ¶çš„æ¨¡å‹ï¼ˆéª¨éª¼ï¼‰ã€‚è¿™ç§ **æ¸è¿›å¼å½¢å¼åŒ–** æ˜¯åº”å¯¹ç»„ç»‡å¤æ‚æ€§çš„ç»ˆææ­¦å™¨ã€‚

## æ ¸å¿ƒç‰¹æ€§

- **å¼•ç”¨å³æŸ¥è¯¢ (Reference as Query)**: `[[ref]]` ä¸åªæ˜¯æŒ‡é’ˆï¼Œå®ƒæ˜¯å¯¹çœŸç†çš„æŸ¥è¯¢æ„å›¾ã€‚
- **ä¸‰é‡è§£æ (Triple Resolution)**: è‡ªåŠ¨æ ¹æ® **Content Hash** (L0)ã€**Handle** (L1) å’Œ **Logical ID** (L2) åç¼©çœŸç†ã€‚
- **æ¼”è¿›è¯­ä¹‰ (Evolution)**: ä½¿ç”¨ `former` è®°å½•æ—¶é—´æµè½¬ï¼Œä½¿ç”¨ `derived_from` è¡¨è¾¾ç»“æ„ç»§æ‰¿ã€‚
- **ç¯å¢ƒå³åœºåŸŸ (Context as Field)**: æ–‡ä»¶çš„ç‰©ç†ä½ç½®å†³å®šå…¶è¯­ä¹‰ã€‚é€šè¿‡ `config.td` å®ç°å±‚çº§åŒ–çš„é…ç½®æ³¨å…¥ã€‚
- **åˆ†å±‚ QC æµæ°´çº¿**: ä»è¯­æ³• Lint åˆ°å¤–éƒ¨äº‹å® Test çš„ä¸¥æ ¼é˜²å¾¡å®ˆå«ã€‚

## å¿«é€Ÿä¸Šæ‰‹

### 1. å®šä¹‰æ¨¡å‹

ç›´æ¥åœ¨ Markdown ä¸­ä½¿ç”¨ Python Pydantic è¯­æ³•å®šä¹‰ Schemaï¼š

````markdown
```model:UserAccount
class UserAccount(BaseModel):
    name: str
    age: int = Field(..., ge=18)
    role: str = "member"
```
````

### 2. å£°æ˜å®ä½“

ä½¿ç”¨å…·æœ‰â€œè¯­æ³•ç³–â€çš„ YAML å£°æ˜æ•°æ®ï¼š

````markdown
```entity UserAccount: alice
id: "iam/user/alice-v1"
name: "Alice"
age: 30
role: "admin"
```
````

### 3. å®šä¹‰è§„èŒƒ

é’ˆå¯¹ç‰¹å®šç±»å‹çš„å®ä½“ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•ï¼š

````markdown
```spec id=check_roles
@target(type="UserAccount")
def validate_admin(subject: UserAccount):
    if subject.role == "admin":
        assert subject.age >= 25, "ç®¡ç†å‘˜å¿…é¡»å…·å¤‡è¶³å¤Ÿçš„èµ„å†"
```
````

## å‘½ä»¤è¡Œæ“ä½œ (CLI)

`td` å·¥å…·æ˜¯æ‚¨å¼€å‘å¾ªç¯çš„æœ€ä½³ä¼´ä¾£ï¼š

- **`td lint`**: (L1) æ£€æŸ¥ Markdown è¯­æ³•ä¸ YAML æ ¼å¼ã€‚
- **`td check`**: (L2) æ‰§è¡Œ Pydantic æ¨¡å‹åˆè§„æ€§æ£€æŸ¥ã€‚
- **`td validate`**: (L3) è¿è¡Œå¼•ç”¨å¯»å€ä¸ `spec` å†…éƒ¨é€»è¾‘æ ¡éªŒã€‚
- **`td test`**: (L4) è¿è¡Œå¤–éƒ¨äº‹å®æ ¸éªŒï¼ˆè°ƒç”¨ API/é¢„è¨€æœºï¼‰ã€‚
- **`td run <script>`**: è¿è¡Œå®šä¹‰åœ¨ Front Matter ä¸­çš„å¿«æ·è„šæœ¬ã€‚

## å®‰è£…

Typedown ä¸“ä¸º [uv](https://docs.astral.sh/uv/) ç”Ÿæ€è®¾è®¡ã€‚æˆ‘ä»¬æ¨èä½¿ç”¨ `uv` æˆ– `uvx`ï¼Œä½“éªŒè¿œè¶…ä¼ ç»Ÿæ–¹å¼ã€‚

### ğŸš€ æé€Ÿè¿è¡Œ (æ¨è)

æ— éœ€é…ç½®ç¯å¢ƒï¼Œä½¿ç”¨ `uvx` å³åˆ»è¿è¡Œ Typedownï¼š

```bash
uvx typedown --help
```

### ğŸ› ï¸ å…¨å±€å®‰è£…

å°†å…¶å®‰è£…ä¸ºç³»ç»Ÿçº§çš„ç‹¬ç«‹å·¥å…·ï¼š

```bash
uv tool install typedown
```

### ğŸ“¦ é¡¹ç›®ä¾èµ–

å°†å…¶æ·»åŠ åˆ°ç°æœ‰çš„ Python é¡¹ç›®ä¸­ï¼š

```bash
uv add typedown
```

### âŒ¨ï¸ VS Code æ’ä»¶

è¯·ä»ä»¥ä¸‹å¸‚åœºå®‰è£… **Typedown Integration**ï¼š

- [VS Code Marketplace (å®˜æ–¹å¸‚åœº)](https://marketplace.visualstudio.com/items?itemName=Typedown.typedown-vscode)
- [Open VSX (å¼€æºæ›¿ä»£)](https://open-vsx.org/extension/Typedown/typedown-vscode)

---

## è®¸å¯è¯

MIT Â© [IndenScale](https://github.com/IndenScale)
